# 什么是HTTP

HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范。

 ![img](https://gitee.com/wanghengg/picture/raw/master/2021/2781919e73f5d258ff1dc371af632acc.png)

* 互联网上绝大部分资源都使用 HTTP 协议传输；
* 浏览器是 HTTP 协议里的请求方，即 User Agent；
* 服务器是 HTTP 协议里的应答方，常用的有 Apache 和 Nginx；
* CDN 位于浏览器和服务器之间，主要起到缓存加速的作用；
* 爬虫是另一类 User Agent，是自动访问网络资源的程序。 

# 常见的HTTP状态码

![image-20210305115959041](https://gitee.com/wanghengg/picture/raw/master/2021/image-20210305115959041.png)

**1XX类状态码告知请求的处理进度和情况**

**2XX类状态码表示服务器成功处理了客户端的请求，是我们最愿意看到的状态**

* **[200 OK]**是最常见的成功状态码，表示一切正常。如果是非HEAD请求，服务器返回的响应头都会有body数据。

* **[204 No Content]**也是常见的成功状态码，也200 OK基本相同，但是响应报文没有body数据。

* **[206 Partial Content]**是应用于HTTP分块下载或断点续传，表示响应返回的body数据并不是资源的的全部，而是其中的一部分，也是服务器处理成功的状态。

**3XX类状态码表示客户端请求的资源发生了变动，需要客户端用新的URI重新发送请求获取资源，也就是重定向，需要进一步操作**

* ****

  **[301 Move Permanently]**表示永久重定向，说明请求的资源已经不存在了，需要改用新的URI再次访问。

* **[302 Found]**表示资源的URI已经临时定位到其他位置了，说明请求的资源还在，但是暂时需要用另一个URI访问。

* **[304 Not Modified]**不具有跳转的含义，表示资源未修改，重定向已存在的缓冲文件，也称缓存重定向，用于缓存控制。

**4XX类状态码表示客户端发送的报文有误，服务器无法处理**

* **[400 Bad Request]**表示客户端请求的报文有错误，但只是一个笼统的错误。
* **[403 Forbidden]**表示服务器禁止访问资源，并不是客户端的请求出错。
* **[404 Not Found]**表示请求的资源在服务器上不存在或未找到，所以无法提供给客户端。

**5XX类状态码表示客户端请求报文正确，但是<font color=red>服务器处理时内部出现了错误</font>，属于服务器端的错误**

**[500 Internal Server Error]**与400类似，是个笼统的错误码，服务器发生了什么错误我们并不知道。

**[501 Not Implemented]**表示客户端请求的功能还不支持。

**[502 Bad Gateway]**通常是服务器作为网关或者代理时返回的错误码，表示服务器自身工作正常，访问后端服务器的时候发生了错误。

**[503 Service Unavailable]**表示服务器当前很忙， 暂时无法响应。

# HTTP的特点（优缺点）

HTTP协议有优缺点一体的双刃剑，分别是**无状态、明文传输**，同时还有一大缺点**不安全**

**<font color=red>对于无状态的解决方法之一就是使用Cookie技术。</font>**客户端第一次向服务器发送请求报文时，服务器在报文中添加Cookie返回，以后客户端每次发送请求报文时都带上Cookie，服务器接收到报文后通过里面的Cookie信息就可以知道客户端的身份。

# HTTP和HTTPS的区别

1. HTTP传输的是明文信息，存在安全风险。HTTP解决了HTTP传输不安全的缺陷，在TCP和HTTP之间加入了SSL/TLS协议，使报文能加密传输。
2. HTTP建立连接相对简单，通过TCP三次握手之后就可以进行HTTP的报文传输。而HTTPS在TCP三次握手之后，还需进行SSL/TLS的握手过程，才能进行加密传输。
3. HTTP的端口号是80，HTTPS的端口号是443
4. HTTPS协议需要向CA（证书权威机构）申请数字证书，用来保证服务器的身份是可信的。

**<font color=red>用于HTTP信息明文传输，所以存在窃听风险、篡改风险、冒充风险</font>**

## HTTPS如何解决上面的三个风险的？

* **混合加密（对称加密和非对称加密混合）**的方式实现了报文信息的机密性，解决了窃听风险。
* **摘要算法**的方式来保证信息的**完整性**，解决了信息的篡改风险。
* 将服务器的公钥放到数字证书中，解决了服务器冒充的风险。

## 对称加密和非对称加密

HTTPS采用的是**对称加密**和**非对称加密**结合的混合加密方式

* 在通信建立之前采用非对称加密的方式交换会话密钥，后续就不需要再使用非对称加密。
* 在通信过程中全部使用的是对称加密的会话密钥的方式加密明文数据。

### 采用混合加密的原因

* 对称加密只有一个密钥：运算速度快，但是密钥必须保密，无法做到安全的密钥交换。
* 非对称加密使用两个密钥：公钥和私钥，公钥可以任意分发而私钥保密，解决了密钥交换问题但是速度慢。
* 为了保证密钥安全交换同时保证报文交换速度，采用了混合加密方式。

## 数字证书

![image-20210305120123220](https://gitee.com/wanghengg/picture/raw/master/2021/image-20210305120123220.png)

客户端向服务端索要公钥，然后用公钥加密信息，但是怎么保证公钥不被篡改？

* 这里用到了数字证书，服务器首先向第三方权威机构CA（数字证书认证机构）申请证书，CA用自己的私钥将服务器的公钥数字签名并颁发数字证书，然后将服务器公钥和证书一起发送给客户端，客户端本地已经实现安装了CA的公钥，所以客户端收到服务器发来的公钥和证书后用CA的公钥确认服务器数字证书的真实性，如果证书有效，那么公钥也可信，接下来客户端课服务器之间就可以通过公钥进行对称加密传输信息了。

# HTTP/1.1、HTPP/2、HTTP/3演变

## HTTP/1.1特点

* TCP采用长连接的方式改善了HTTP/1.0短连接造成的开销。
* 支持管道网络传输，只要一个请求发出去了，不必等其回来，就可以发出第二个请求，减少整体响应时间。

## HTTP/1.1的缺点

* 请求/响应头部未经压缩就发送，首部信息越多延迟越大，导致只能压缩body数据。
* 发送冗长的首部。每次发送相同的首部造成资源浪费。
* 服务器是按请求的顺序响应的，如果服务器响应慢，会导致客户端一直请求不到数据，造成队头阻塞。
* 没有请求优先级控制。
* 请求只能从客户端开始，服务器只能被动响应。

## HTTP/2的改进

1. **头部压缩。**如果同时发送多个请求它们的头部是一样的，那么协议会消除重复的部分。这就是HPACK算法。
2. **二进制格式。**HTTP/2不像HTTP/1.1一样使用纯文本形式的报文，而是全面使用了二进制格式。对于计算机来说，接收到报文后不需要将明文格式的报文转换为二进制，提高了数据传输的效率。
3. **数据流。**HTTP/2的数据包不是按顺序发送的，同一个连接里连续的数据包可能属于不同的响应。每个请求或者响应的数据包，成为一个数据流。客户端还可以指定数据流的优先级。优先级高的请求，服务器优先响应。
4. **多路复用。**HTTP/2可以在一个TCP连接里面并发多个请求或者响应，而不用按照顺序一一对应。不需要排队等待，也就没有队头阻塞的问题了。*<font color=red>举例来说，在一个 TCP 连接里，服务器收到了客户端 A 和 B 的两个请求，如果发现 A 处理过程非常耗时，于是就回应 A 请求已经处理好的部分，接着回应 B 请求，完成后，再回应 A 请求剩下的部分</font>*
5. **服务器推送。**服务器不再是被动地响应，也可以主动向客户端发送消息。

![image-20210305120201826](https://gitee.com/wanghengg/picture/raw/master/2021/image-20210305120201826.png)

### HTTP/2的缺陷

HTTP/2 主要的问题在于：多个 HTTP 请求在复用一个 TCP 连接，下层的 TCP 协议是不知道有多少个 HTTP 请求的。所以一旦发生了丢包现象，就会触发 TCP 的重传机制，这样在一个 TCP 连接中的所有的 HTTP 请求都必须等待这个丢了的包被重传回来。